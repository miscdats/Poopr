(function(e){function t(t){for(var a,o,i=t[0],c=t[1],l=t[2],d=0,p=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&p.push(r[o][0]),r[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(p.length)p.shift()();return s.push.apply(s,l||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],a=!0,i=1;i<n.length;i++){var c=n[i];0!==r[c]&&(a=!1)}a&&(s.splice(t--,1),e=o(o.s=n[0]))}return e}var a={},r={app:0},s=[];function o(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=a,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var u=c;s.push([1,"chunk-vendors"]),n()})({0:function(e,t){},1:function(e,t,n){e.exports=n("56d7")},2:function(e,t){},3:function(e,t){},4:function(e,t){},4678:function(e,t,n){var a={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn-bd":"9686","./bn-bd.js":"9686","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-in":"ec2e","./en-in.js":"ec2e","./en-nz":"6f50","./en-nz.js":"6f50","./en-sg":"b7e9","./en-sg.js":"b7e9","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-mx":"b5b7","./es-mx.js":"b5b7","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fil":"d69a","./fil.js":"d69a","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-deva":"aaf2","./gom-deva.js":"aaf2","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./oc-lnc":"167b","./oc-lnc.js":"167b","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tk":"5aff","./tk.js":"5aff","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-mo":"3a6c","./zh-mo.js":"3a6c","./zh-tw":"90ea","./zh-tw.js":"90ea"};function r(e){var t=s(e);return n(t)}function s(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=s,e.exports=r,r.id="4678"},"48ba":function(e,t,n){e.exports=n.p+"img/overview.dab17505.jpg"},5:function(e,t){},"52dd":function(e,t,n){"use strict";n("d3b7"),n("25f0");var a=n("b1c9"),r=a.S2Cell,s=a.S2LatLng,o=function(e,t,n){var a=function(e,t){var n=s.fromDegrees(e,t),a=r.fromLatLng(n),o=a.id;return o.id},o=function(e,t){e.lessThan(0)&&t++;var n=e.toString(10),a=Math.pow(10,n.length-t);return e.divide(a)},i=a(e,t),c=o(i,n);return c.toString(10)};e.exports={getGeoHashCell:o}},"56d7":function(e,t,n){"use strict";n.r(t),n.d(t,"bus",(function(){return Ue}));n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),r=n("755e"),s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",[a("v-app-bar",{attrs:{app:"",color:"primary",dark:""}},[a("div",{staticClass:"d-flex align-center"},[a("v-img",{staticClass:"shrink mr-2",attrs:{alt:"Poopr",contain:"",src:n("76cf"),transition:"scale-transition",width:"160"}})],1),a("v-spacer"),e.$auth.loading?e._e():a("div",[e.$auth.isAuthenticated?e._e():a("v-btn",{attrs:{text:""},on:{click:e.login}},[a("span",{staticClass:"mr-2"},[e._v("Log in")]),a("v-icon",[e._v("mdi-account-circle")])],1),e.$auth.isAuthenticated?a("v-btn",{attrs:{text:""},on:{click:e.logout}},[a("span",{staticClass:"mr-2"},[e._v("Log out")]),a("v-icon",[e._v("mdi-account-arrow-right")])],1):e._e()],1)],1),a("v-content",[a("v-container",{staticClass:"pa-0 ma-0"},[e.authReady?a("router-view"):e._e()],1)],1),a("iot")],1)},o=[],i=(n("96cf"),n("1da1")),c={name:"App",data:function(){return{authReady:!1}},created:function(){var e=this;Ue.$on("loaded",Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("Auth loaded"),e.$store.commit("setInitialized",!0),e.authReady=!0;case 3:case"end":return t.stop()}}),t)}))))},methods:{login:function(){this.$auth.loginWithRedirect()},logout:function(){this.$auth.logout({returnTo:window.location.origin})}}},l=c,u=n("2877"),d=n("6544"),p=n.n(d),f=n("7496"),h=n("40dc"),g=n("8336"),m=n("a523"),b=n("a75b"),v=n("132d"),k=n("adda"),j=n("2fa4"),y=Object(u["a"])(l,s,o,!1,null,null,null),w=y.exports;p()(y,{VApp:f["a"],VAppBar:h["a"],VBtn:g["a"],VContainer:m["a"],VContent:b["a"],VIcon:v["a"],VImg:k["a"],VSpacer:j["a"]});var C=n("f309");a["a"].use(C["a"]);var x=new C["a"]({}),_=n("8c4f"),S=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home"},[n("v-container",[n("v-card",{staticClass:"ma-2"},[n("v-card-title",{staticClass:"headline"},[e._v("Look For Potty")]),n("v-card-subtitle",[e._v("Seek relief with users around you.")]),n("v-form",{ref:"form",staticClass:"ma-4",attrs:{"lazy-validation":e.lazy},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[n("v-text-field",{attrs:{counter:100,rules:e.seekRules,label:"Seek",required:""},model:{value:e.seek,callback:function(t){e.seek=t},expression:"seek"}}),n("v-select",{attrs:{items:e.items,rules:[function(e){return!!e||"Seek type is required"}],label:"Seek type",required:""},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}}),n("v-spacer"),n("v-card-actions",[n("v-spacer"),n("v-btn",{staticClass:"mr-4",attrs:{disabled:!e.valid,color:"success",text:""},on:{click:e.saveSeek}},[e._v("Submit")]),n("v-btn",{staticClass:"mr-4",attrs:{color:"error",text:""},on:{click:e.reset}},[e._v("Cancel")])],1)],1)],1)],1)],1)},O=[],$=n("bc3a"),z=n.n($),V={name:"AskView",data:function(){return{valid:!0,seek:"",seekRules:[function(e){return!!e||"Seek is required"},function(e){return e&&e.length<=100||"Seek must be less than 100 characters"}],type:null,items:["Star rating","Geo rating"],lazy:!1}},methods:{validate:function(){this.$refs.form.validate()},reset:function(){this.$refs.form.reset(),this.$router.push("/")},saveSeek:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,a,r,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$auth.getTokenSilently();case 2:return n=t.sent,a="".concat(e.$APIurl,"/seeks"),r={seek:e.seek,type:e.type,position:e.$store.getters.getPosition},console.log("URL: ",a),console.log("Payload: ",r),t.prev=7,t.next=10,z.a.post(a,r,{headers:{Authorization:"Bearer ".concat(n)}});case 10:s=t.sent,o=s.data,console.log("Result: ",o),t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](7),console.error("Error: ",t.t0);case 18:e.reset();case 19:case"end":return t.stop()}}),t,null,[[7,15]])})))()}}},I=V,R=n("b0af"),A=n("99d9"),L=n("4bd4"),T=n("b974"),P=n("8654"),D=Object(u["a"])(I,S,O,!1,null,null,null),M=D.exports;p()(D,{VBtn:g["a"],VCard:R["a"],VCardActions:A["a"],VCardSubtitle:A["b"],VCardTitle:A["d"],VContainer:m["a"],VForm:L["a"],VSelect:T["a"],VSpacer:j["a"],VTextField:P["a"]});var K=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-container",{staticClass:"pa-0 ma-0"},[e.$auth.isAuthenticated?e._e():a("div",{attrs:{id:"unauth-view"}},[a("v-card",{staticClass:"ma-2"},[a("v-list-item",[a("v-list-item-avatar",{attrs:{color:"grey"}}),a("v-list-item-content",[a("v-list-item-title",{staticClass:"headline"},[e._v("Welcome!")]),a("v-list-item-subtitle",[e._v("Share local points of relief")])],1)],1),a("v-img",{attrs:{src:n("48ba"),height:"194"}}),a("v-card-text",[e._v(" Who has the best sink? Where's the GOOD toilet at the local park? Get the answers for that which you seek, relief and more from locals that know! ")]),a("v-card-actions",[a("v-btn",{attrs:{text:"",color:"orange",href:"https://bit.ly/poopr",target:"_blank"}},[e._v(" Learn more ")]),a("v-btn",{attrs:{text:"",color:"orange",href:"https://github.com/miscdats/poopr/",target:"_blank"}},[e._v(" GitHub ")]),a("v-spacer")],1)],1)],1),e.$auth.isAuthenticated?a("v-container",{staticClass:"pa-0 ma-0",attrs:{id:"auth-view"}},[a("GmapMap",{staticStyle:{width:"100%",height:"300px"},attrs:{center:{lat:this.currentLat,lng:this.currentLng},zoom:7,"map-type-id":"roadmap",options:{zoomControl:!0,zoom:11,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1,disableDefaultUI:!1}}},[e._l(e.seeks,(function(t,n){return a("GmapMarker",{key:n,attrs:{position:{lat:t.latitude,lng:t.longitude},clickable:!1,draggable:!1},on:{click:function(n){e.center=t.position}}})})),a("GmapCircle",{attrs:{center:{lat:e.currentLat,lng:e.currentLng},radius:8e3,options:{fillColor:"blue",fillOpacity:.1,strokeColor:"#0000FF",strokeOpacity:.2,strokeWeight:5}}})],2)],1):e._e(),e.$auth.isAuthenticated&&e.loading?a("v-container",[a("div",{staticClass:"text-center"},[a("v-progress-circular",{attrs:{size:50,color:"orange",indeterminate:""}})],1)]):e._e(),0!==e.seeks.length||e.loading?e._e():a("v-container",[a("v-card",{staticClass:"ma-2"},[a("v-card-title",{staticClass:"headline"},[e._v("No toilets here? No way.")]),a("v-card-subtitle",[e._v("Whoa! This is a quiet neighborhood. Be the first to seek relief.")]),a("v-card-actions",[a("v-btn",{attrs:{color:"orange",text:""}},[e._v("Look For Potty")])],1)],1)],1),e.seeks.length>0?a("v-container",{staticClass:"pa-0 ma-0"},e._l(e.seeks,(function(e,t){return a("v-container",{key:t,staticClass:"pa-0 ma-0"},[a("Seek",{attrs:{seek:e}})],1)})),1):e._e(),a("v-container",{staticClass:"pa-0 ma-0"},[e.$auth.isAuthenticated?a("v-btn",{staticClass:"mb-4",attrs:{fixed:"",dark:"",fab:"",bottom:"",right:"",color:"red",to:"/ask"}},[a("v-icon",[e._v("add")])],1):e._e()],1)],1)},U=[],G=(n("99af"),n("5530")),W=n("2f62"),q=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",{staticClass:"pa-0 ma-0"},[n("v-card",{staticClass:"my-2 ma-2"},[n("v-card-text",[n("div",{staticClass:"my-2 subtitle-1"},[e._v(e._s(e.seek.seek))]),"Star"===e.seek.type?n("div",[n("v-rating",{attrs:{value:e.seek.avgScore,color:"amber",dense:"","half-increments":"",readonly:"",size:"24"}}),e._v(" ("+e._s(e.seek.answers)+" ratings) ")],1):e._e(),n("div",{staticClass:"my-4 subtitle-2"},[e._v(" Posted "),n("strong",[e._v(e._s(e.moment.unix(e.seek.created/1e3).fromNow()))]),e.seek.author===e.$store.getters.getUser.sub?n("strong",[e._v(" by you")]):e._e()])]),e.seek.author!=e.$store.getters.getUser.sub?n("v-card-actions",["Star"===e.seek.type?n("div",[n("v-btn",{attrs:{text:"",color:"orange",dark:""},on:{click:function(t){return e.openDialog(e.seek)}}},[e._v(" Answer ")])],1):e._e(),"Geo"===e.seek.type?n("div",[n("v-btn",{attrs:{text:"",color:"orange",dark:""},on:{click:function(t){return e.openMapDialog(e.seek)}}},[e._v(" Answer on map ")]),n("v-btn",{attrs:{disabled:0===e.seek.answers,text:"",color:"orange",dark:"",to:{name:"Answers",query:{hk:e.seek.hashKey,rk:e.seek.rangeKey}}}},[e._v(" See results ")])],1):e._e()]):e._e(),n("v-divider",{staticClass:"mx-4"})],1),n("v-dialog",{attrs:{persistent:"","max-width":"290"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[n("v-card",[n("v-card-title",{staticClass:"headline"},[e._v("Your rating:")]),n("v-card-text",[n("v-rating",{attrs:{color:"amber",dense:"","half-increments":"",size:"40"},model:{value:e.starRating,callback:function(t){e.starRating=t},expression:"starRating"}})],1),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{disabled:0===e.starRating||!0===e.saving,color:"success",text:""},on:{click:function(t){return e.submitDialog("star")}}},[e._v("Submit")]),n("v-btn",{attrs:{disabled:!0===e.saving,color:"error",text:""},on:{click:function(t){e.dialog=!1}}},[e._v("Cancel")])],1)],1)],1),n("v-dialog",{attrs:{persistent:""},model:{value:e.mapDialog,callback:function(t){e.mapDialog=t},expression:"mapDialog"}},[n("v-card",[n("v-card-title",{staticClass:"headline"},[e._v("Drop a pin on your answer:")]),n("v-card-text",[n("GmapMap",{ref:"gmap",staticStyle:{width:"100%",height:"400px"},attrs:{center:{lat:this.position.latitude,lng:this.position.longitude},zoom:7,"map-type-id":"roadmap",options:{zoomControl:!1,zoom:11,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1,disableDefaultUI:!1}}},[e._l(e.markers,(function(t,a){return n("GmapMarker",{key:a,attrs:{position:t.position},on:{click:function(n){e.center=t.position}}})})),n("GmapCircle",{attrs:{center:{lat:this.currentSeek.latitude,lng:this.currentSeek.longitude},radius:8e3,options:{fillColor:"blue",fillOpacity:.1,strokeColor:"#0000FF",strokeOpacity:.2,strokeWeight:5}},on:{click:e.addMarker}})],2)],1),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{disabled:0===e.markers.length||!0===e.saving,color:"success",text:""},on:{click:function(t){return e.submitDialog("geo")}}},[e._v("Submit")]),n("v-btn",{attrs:{disabled:!0===e.saving,color:"error",text:""},on:{click:function(t){e.mapDialog=!1}}},[e._v("Cancel")])],1)],1)],1)],1)},H=[],N={name:"HomeView",props:["seek"],data:function(){return{dialog:!1,mapDialog:!1,markers:[],starRating:0,saving:!1,currentSeek:{latitude:40.7358235,longitude:-73.9927102}}},computed:Object(G["a"])({},Object(W["b"])({position:function(e){return e.position}})),methods:{openDialog:function(e){console.log(e),this.currentSeek=e,this.starRating=0,this.dialog=!0},openMapDialog:function(e){console.log(e),this.currentSeek=e,this.markers=[],this.mapDialog=!0},addMarker:function(e){var t={lat:e.latLng.lat(),lng:e.latLng.lng()};this.markers.pop(),this.markers.push({position:t})},submitDialog:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var a,r,s,o,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return console.log("submitDialog"),n.next=3,t.$auth.getTokenSilently();case 3:return a=n.sent,r="".concat(t.$APIurl,"/answers"),t.saving=!0,s={seek:t.seek,type:e},"star"===e?s.rating=t.starRating:(s.lat=t.markers[0].position.lat,s.lng=t.markers[0].position.lng),console.log("Payload: ",s),n.prev=9,n.next=12,z.a.post(r,s,{headers:{Authorization:"Bearer ".concat(a)}});case 12:o=n.sent,i=o.data,console.log("Result: ",i),n.next=20;break;case 17:n.prev=17,n.t0=n["catch"](9),console.error("Error: ",n.t0);case 20:t.dialog=!1,t.mapDialog=!1,t.saving=!1;case 23:case"end":return n.stop()}}),n,null,[[9,17]])})))()}}},F=N,B=n("169a"),E=n("ce7e"),J=n("1d4d"),Z=Object(u["a"])(F,q,H,!1,null,null,null),Q=Z.exports;p()(Z,{VBtn:g["a"],VCard:R["a"],VCardActions:A["a"],VCardText:A["c"],VCardTitle:A["d"],VContainer:m["a"],VDialog:B["a"],VDivider:E["a"],VRating:J["a"],VSpacer:j["a"]});var X={name:"HomeView",components:{Seek:Q},data:function(){return{currentLat:40.7358235,currentLng:-73.9927102,loading:!0,user:null}},computed:Object(G["a"])({},Object(W["b"])(["seeks"])),mounted:function(){var e=this;console.log("mounted"),navigator.geolocation.getCurrentPosition((function(t){console.log("Position returned: ",t),e.$store.commit("setPosition",t),e.currentLat=t.coords.latitude,e.currentLng=t.coords.longitude,e.updateResults()}),(function(){console.log("Error: The Geolocation service failed.")}),{enableHighAccuracy:!0,timeout:3e4})},created:function(){var e=this;Ue.$on("authenticated",function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$store.commit("setUser",n),console.log("User signed in: ",e.$store.getters.getUser);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},methods:{updateResults:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,a,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.$store.getters.isInitialized){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.$auth.getTokenSilently();case 4:return n=t.sent,a="".concat(e.$APIurl,"/seeks?lat=").concat(e.currentLat,"&lng=").concat(e.currentLng),console.log("URL: ",a),t.next=9,z.a.get(a,{headers:{Authorization:"Bearer ".concat(n)}});case 9:r=t.sent,s=r.data,console.log("Response: ",s),e.$store.commit("setAllSeeks",s),e.loading=!1;case 14:case"end":return t.stop()}}),t)})))()}}},Y=X,ee=n("da13"),te=n("8270"),ne=n("5d23"),ae=n("490a"),re=Object(u["a"])(Y,K,U,!1,null,null,null),se=re.exports;p()(re,{VBtn:g["a"],VCard:R["a"],VCardActions:A["a"],VCardSubtitle:A["b"],VCardText:A["c"],VCardTitle:A["d"],VContainer:m["a"],VIcon:v["a"],VImg:k["a"],VListItem:ee["a"],VListItemAvatar:te["a"],VListItemContent:ne["a"],VListItemSubtitle:ne["b"],VListItemTitle:ne["c"],VProgressCircular:ae["a"],VSpacer:j["a"]});var oe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",{staticClass:"pa-0 ma-0"},[e.loading?n("v-container",[n("div",{staticClass:"text-center"},[n("v-progress-circular",{attrs:{size:50,color:"orange",indeterminate:""}})],1)]):e._e(),e.loading?e._e():n("v-container",{staticClass:"pa-0 ma-0",attrs:{id:"answersMap"}},[n("GmapMap",{staticStyle:{width:"100%",height:"80vh"},attrs:{center:{lat:this.currentLat,lng:this.currentLng},zoom:7,"map-type-id":"roadmap",options:{zoomControl:!0,zoom:11,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,rotateControl:!1,fullscreenControl:!1,disableDefaultUI:!1}}},[e._l(e.blocks,(function(e,t){return n("GmapCircle",{key:t,attrs:{center:{lat:e.center.lat,lng:e.center.lng},radius:250+1500*e.pct,options:{fillColor:e.color,fillOpacity:.8,strokeColor:e.color,strokeOpacity:.8,strokeWeight:2}}})})),n("GmapCircle",{attrs:{center:{lat:e.currentLat,lng:e.currentLng},radius:8e3,options:{fillColor:"blue",fillOpacity:.1,strokeColor:"#0000FF",strokeOpacity:.2,strokeWeight:5}}})],2)],1),n("v-container",{staticClass:"pa-0 ma-0"},[e.$auth.isAuthenticated?n("v-btn",{staticClass:"mb-4",attrs:{fixed:"",dark:"",fab:"",bottom:"",right:"",color:"gray",to:"/"}},[n("v-icon",[e._v("arrow_back")])],1):e._e()],1)],1)},ie=[],ce=(n("d81d"),n("e02a")),le=["answers","totalScore","geohash","seek","geoJson","hashKey","created","rangeKey","type","state","author"],ue={name:"Answers",components:{},data:function(){return{currentLat:40.7358235,parentHeight:600,currentLng:-73.9927102,loading:!0,hk:null,rk:null,blocks:[]}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("mounted"),console.log(e.$route.query),e.hk=e.$route.query.hk,e.rk=e.$route.query.rk,e.parentHeight=e.$parent.$el.offsetHeight,!e.hk||!e.rk){t.next=8;break}return t.next=8,e.loadAnswers();case 8:case"end":return t.stop()}}),t)})))()},methods:{loadAnswers:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n,a,r,s,o,i,c,l,u,d,p;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return l=function(e){var t=240*(1-e);return"hsl(".concat(t,",100%,50%)")},console.log("loadAnswers called"),n="".concat(e.$APIurl,"/geoSeek?hk=").concat(e.hk,"&rk=").concat(e.rk),t.next=5,e.$auth.getTokenSilently();case 5:return a=t.sent,console.log("URL: ",n),t.next=9,z.a.get(n,{headers:{Authorization:"Bearer ".concat(a)}});case 9:for(c in r=t.sent,s=r.data,console.log("Response: ",s),o=JSON.parse(s.geoJson.S).coordinates,e.currentLng=o[0],e.currentLat=o[1],le.map((function(e){return delete s[e]})),i=0,s)i+=parseInt(s[c].N);for(u in s)s[u].percent=s[u].N/i,s[u].color=l(s[u].percent);for(d in s)p=ce.decode_bbox(d),e.blocks.push({north:p[0],south:p[2],east:p[3],west:p[1],color:s[d].color,pct:s[d].percent,center:{lat:(p[0]+p[2])/2,lng:(p[1]+p[3])/2}});e.loading=!1;case 21:case"end":return t.stop()}}),t)})))()}}},de=ue,pe=Object(u["a"])(de,oe,ie,!1,null,null,null),fe=pe.exports;p()(pe,{VBtn:g["a"],VContainer:m["a"],VIcon:v["a"],VProgressCircular:ae["a"]}),a["a"].use(_["a"]);var he=[{path:"/ask",name:"AskView",component:M},{path:"/",name:"HomeView",component:se},{path:"/answers",name:"Answers",component:fe}],ge=new _["a"]({mode:"history",base:"/",routes:he}),me=ge,be=n("52dd"),ve=n.n(be);a["a"].use(W["a"]);var ke,je,ye=5,we={initialized:!1,position:{latitude:"-70.8238872",longitude:"43.0385959"},hashKey:"",user:{},seeks:[]},Ce={isInitialized:function(e){return e.initialized},getPosition:function(e){return e.position},getUser:function(e){return e.user},getSeeks:function(e){return e.seeks},getHashKey:function(e){return e.hashKey}},xe={setPosition:function(e,t){e.position.latitude=t.coords.latitude,e.position.longitude=t.coords.longitude;var n=ve.a.getGeoHashCell(t.coords.latitude,t.coords.longitude,ye);e.hashKey=n},saveSeek:function(e,t){for(var n in console.log("store::saveSeek:",t),e.seeks)if(console.log(e.seeks[n]),e.seeks[n].rangeKey===t.rangeKey)return console.log("Matched: ",t.rangeKey),e.seeks[n].answers=t.answers,void(e.seeks[n].avgScore=t.avgScore);console.log("Not in store - adding"),e.seeks.push(t)},setUser:function(e,t){e.user=t},setHashKey:function(e,t){e.hashKey=t},setInitialized:function(e,t){console.log("setInitalized"),e.initialized=t},setAllSeeks:function(e,t){e.seeks=t},updateSeek:function(e,t){for(var n in console.log("store::updateSeek"),e.seeks)e.seeks[n].rangeKey===t.rangeKey&&(e.seeks[n].answers=t.answers,e.seeks[n].avgScore=t.avgScore,console.log("Updated seek: ",e.seeks[n].rangeKey))}},_e=new W["a"].Store({state:we,getters:Ce,mutations:xe}),Se=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div")},Oe=[],$e=(n("d3b7"),n("25f0"),{name:"IoT",computed:Object(G["a"])({},Object(W["b"])({init:function(e){return e.initialized},hash:function(e){return e.hashKey}})),watch:{init:function(){this.init&&(this.mountIOT(),console.log("Mounting websocket"))},hash:function(){console.log("IoT subscribing to ",this.hash),this.subscribe(this.hash)}},methods:{subscribe:function(e){console.log("IoT subcribing to ",e),ke.subscribe(e)},mountIOT:function(){var e=this.$store,t=n("4a9d"),a=n("fefd"),r=0,s={poolId:this.$poolId,host:this.$host,region:this.$region},o="new-answer",i="askAroundMe-"+Math.floor(1e5*Math.random()+1);t.config.region=s.region,t.config.credentials=new t.CognitoIdentityCredentials({IdentityPoolId:s.poolId}),console.log("IoT created"),ke=a.device({region:t.config.region,host:s.host,clientId:i,protocol:"wss",maximumReconnectTimeMs:8e3,debug:!1,accessKeyId:"",secretKey:"",sessionToken:""});var c=new t.CognitoIdentity,l=function(){t.config.credentials.get((function(e,n){if(!e){console.log("retrieved identity: "+t.config.credentials.identityId,n);var a={IdentityId:t.config.credentials.identityId};c.getCredentialsForIdentity(a,(function(e,t){e||ke.updateWebSocketCredentials(t.Credentials.AccessKeyId,t.Credentials.SecretKey,t.Credentials.SessionToken)}))}}))};ke.on("connect",(function(){console.log("mqttClient connected"),ke.subscribe(o)})),ke.on("error",(function(e){r>0&&console.log("mqttClient error:",e),r++,l()})),ke.on("message",(function(t,n){var a=JSON.parse(n.toString());console.log("IoT msg: ",t,a),"new-answer"===t?(console.log("update"),e.commit("updateSeek",a)):(console.log("New seek"),e.commit("saveSeek",a))}))}}}),ze=$e,Ve=Object(u["a"])(ze,Se,Oe,!1,null,null,null),Ie=Ve.exports,Re=n("c1df"),Ae=n.n(Re),Le=n("8160"),Te=(n("caad"),n("ac1f"),n("2532"),n("841c"),n("15fd")),Pe=n("9767"),De=function(){return window.history.replaceState({},document.title,window.location.pathname)},Me=function(e){var t=e.onRedirectCallback,n=void 0===t?De:t,r=e.redirectUri,s=void 0===r?window.location.origin:r,o=Object(Te["a"])(e,["onRedirectCallback","redirectUri"]);return je||(je=new a["a"]({data:function(){return{loading:!0,isAuthenticated:!1,user:{},auth0Client:null,popupOpen:!1,error:null}},methods:{loginWithPopup:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.popupOpen=!0,n.prev=1,n.next=4,t.auth0Client.loginWithPopup(e);case 4:n.next=9;break;case 6:n.prev=6,n.t0=n["catch"](1),console.error(n.t0);case 9:return n.prev=9,t.popupOpen=!1,n.finish(9);case 12:return n.next=14,t.auth0Client.getUser();case 14:t.user=n.sent,t.isAuthenticated=!0;case 16:case"end":return n.stop()}}),n,null,[[1,6,9,12]])})))()},handleRedirectCallback:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,e.auth0Client.handleRedirectCallback();case 4:return t.next=6,e.auth0Client.getUser();case 6:e.user=t.sent,e.isAuthenticated=!0,Ue.$emit("authenticated",e.user),t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](1),e.error=t.t0;case 14:return t.prev=14,Ue.$emit("loaded",!0),e.loading=!1,t.finish(14);case 18:case"end":return t.stop()}}),t,null,[[1,11,14,18]])})))()},loginWithRedirect:function(e){return this.auth0Client.loginWithRedirect(e)},getIdTokenClaims:function(e){return this.auth0Client.getIdTokenClaims(e)},getTokenSilently:function(e){return this.auth0Client.getTokenSilently(e)},getTokenWithPopup:function(e){return this.auth0Client.getTokenWithPopup(e)},logout:function(e){return this.auth0Client.logout(e)}},created:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(Pe["a"])({domain:o.domain,client_id:o.clientId,audience:o.audience,redirect_uri:s});case 2:if(e.auth0Client=t.sent,t.prev=3,!window.location.search.includes("code=")||!window.location.search.includes("state=")){t.next=10;break}return t.next=7,e.auth0Client.handleRedirectCallback();case 7:a=t.sent,r=a.appState,n(r);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](3),e.error=t.t0;case 15:return t.prev=15,t.next=18,e.auth0Client.isAuthenticated();case 18:return e.isAuthenticated=t.sent,t.next=21,e.auth0Client.getUser();case 21:return e.user=t.sent,e.loading=!1,Ue.$emit("authenticated",e.user),Ue.$emit("loaded",!0),t.finish(15);case 26:case"end":return t.stop()}}),t,null,[[3,12,15,26]])})))()}}),je)},Ke={install:function(e,t){e.prototype.$auth=Me(t)}};a["a"].prototype.moment=Ae.a,a["a"].component("iot",Ie),a["a"].config.productionTip=!1,a["a"].prototype.$appName="Poopr",a["a"].prototype.$GoogleMapsKey="AIzaSyDroOWOPbDvOPIMhLHvX7MK6etbqr6C3Z8",a["a"].prototype.$APIurl="https://48yrk78uil.execute-api.us-west-2.amazonaws.com",a["a"].prototype.$poolId="us-west-2:5b3b653f-46d4-43b0-a466-79fccddf0618",a["a"].prototype.$host="ai4m81gweyn4a-ats.iot.us-west-2.amazonaws.com",a["a"].prototype.$region="us-west-2",a["a"].use(r,{load:{key:a["a"].prototype.$GoogleMapsKey,libraries:"places"},installComponents:!0}),a["a"].use(Ke,{domain:Le["c"],clientId:Le["b"],audience:Le["a"],onRedirectCallback:function(e){me.push(e&&e.targetUrl?e.targetUrl:window.location.pathname)}});var Ue=new a["a"];new a["a"]({vuetify:x,router:me,store:_e,render:function(e){return e(w)}}).$mount("#app")},"76cf":function(e,t,n){e.exports=n.p+"img/poopr-wide.a4325bf4.png"},8160:function(e){e.exports=JSON.parse('{"c":"dev-r5kpc3rh.auth0.com","b":"cZW7ge4QJK0nmh14COWMDwy4euO5RxH6","a":"https://auth0-jwt-authorizer"}')}});
//# sourceMappingURL=app.f83b879a.js.map